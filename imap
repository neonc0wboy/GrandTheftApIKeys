import imaplib
import poplib
import smtplib
from email.mime.text import MIMEText

# IMAP4 Settings
imap_server = 'imap.mail.ru'
imap_username = 'nikita_mailml'
imap_password = 'SBpq9yHLj6mFrwWdceta'

# POP3 Settings
pop_server = 'pop.example.com'
pop_username = 'your_username'
pop_password = 'your_password'

# Forwarding Settings
from_address = 'your_email@example.com'
to_address = 'example@mail.ru'

# Connect to IMAP4 server
imap = imaplib.IMAP4(imap_server)
imap1 = imap.starttls(imap)
imap.starttls(imap1)
imap.select()

# Get all email ids in the mailbox
status, email_ids = imap.search(None, 'ALL')
email_ids = email_ids[0].split()

for email_id in email_ids:
    # Fetch the email data
    status, email_data = imap.fetch(email_id, '(RFC822)')
    raw_email = email_data[0][1]

    # Check if the email is from accounts@albiononline.com
    if 'From: accounts@albiononline.com' in raw_email:
        # Create a new message to forward
        forward_msg = MIMEText(raw_email)
        forward_msg['Subject'] = 'Forwarded email'
        forward_msg['From'] = from_address
        forward_msg['To'] = to_address

        # Connect to SMTP server and send the forwarded email
        smtp = smtplib.SMTP('smtp.example.com')
        smtp.sendmail(from_address, [to_address], forward_msg.as_string())
        smtp.quit()

# Disconnect from IMAP4 server
imap.logout()

# Connect to POP3 server
pop = poplib.POP3(pop_server)
pop.user(pop_username)
pop.pass_(pop_password)

# Get the number of emails in the mailbox
num_emails = len(pop.list()[1])

for i in range(1, num_emails+1):
    # Retrieve the email at index i
    response, email_data, octets = pop.retr(i)
    raw_email = b'\n'.join(email_data)

    # Check if the email is from accounts@albiononline.com
    if 'From: accounts@albiononline.com' in raw_email.decode():
        # Create a new message to forward
        forward_msg = MIMEText(raw_email.decode())
        forward_msg['Subject'] = 'Forwarded email'
        forward_msg['From'] = from_address
        forward_msg['To'] = to_address

        # Connect to SMTP server and send the forwarded email
        smtp = smtplib.SMTP('smtp.example.com')
        smtp.sendmail(from_address, [to_address], forward_msg.as_string())
        smtp.quit()

# Disconnect from POP3 server
pop.quit()
